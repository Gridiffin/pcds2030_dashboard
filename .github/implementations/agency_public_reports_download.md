# Agency Public Reports Download Feature

## Problem Description
Agencies currently cannot access reports that admins have marked as "Make available to agencies". We need to implement a simple download page where agencies can access and download public reports (is_public = 1) generated by admins.

## Requirements
- [ ] Create a new page for agencies to view and download public reports
- [ ] Add an icon/button beside the notification bell in agency header
- [ ] Show all reports where `is_public = 1` regardless of agency sector/program
- [ ] Allow direct download of the PPTX files
- [ ] Send notifications to all agencies when a new public report is available
- [ ] Simple, clean interface showing report name, description, date, and download button

## Implementation Steps

### 1. Database Analysis
- [x] Verify reports table structure and is_public column
- [x] Check existing reports and file paths
- [x] Understand file storage structure

### 2. Create Agency Reports Function
- [x] Create function to fetch public reports (is_public = 1)
- [x] Add to appropriate agency functions file
- [x] Include proper SQL parameterization

### 3. Create Agency Public Reports Page
- [x] Create new view file: `app/views/agency/reports/public_reports.php`
- [x] Implement clean table layout with download buttons
- [x] Add proper error handling and empty state
- [x] Include proper header and footer

### 4. Update Agency Navigation
- [x] Add icon/button beside notification bell in agency header
- [x] Use appropriate FontAwesome icon (fa-file-download or similar)
- [x] Ensure proper spacing and responsive design

### 5. Notification System (Optional Enhancement)
- [ ] Create notification when admin marks report as public
- [ ] Send to all agencies
- [ ] Link notification to public reports page

### 6. Testing
- [x] Test with existing reports
- [x] Test admin flow: generate → mark public → verify agency access
- [x] Test download functionality
- [x] Test responsive design
- [x] Fix ROOT_PATH constant issue
- [x] Fix header/footer include paths
- [x] Fix download links to use download.php handler (same as admin side)

## Files to Create/Modify

### New Files
- [x] `app/views/agency/reports/public_reports.php` - Main public reports page
- [x] Function in appropriate agency lib file for fetching public reports

### Files to Modify
- [x] Agency header/navigation file (to add the icon/button)
- [x] Public reports page (to use proper download.php handler)
- [ ] Possibly notification system files

## Technical Considerations
- [x] Use existing project patterns and styling
- [x] Follow established file structure
- [x] Use proper error handling
- [x] Ensure file download security
- [x] Maintain responsive design
- [x] Follow project coding standards
- [x] Fix PROJECT_ROOT_PATH definition issue
- [x] Fix include paths for header and footer files
- [x] Use secure download.php handler for file downloads

## Success Criteria
- [x] Analysis completed and requirements understood
- [x] Agencies can access public reports via new icon/button
- [x] Download functionality works correctly
- [x] Clean, user-friendly interface
- [x] Proper integration with existing navigation
- [x] No security vulnerabilities in file access
