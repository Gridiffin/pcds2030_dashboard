<?php
// Simple test to verify chart data
require_once '../app/config/config.php';
?>
<!DOCTYPE html>
<html>
<head>
    <title>Chart Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        .chart-container {
            position: relative;
            height: 400px;
            width: 600px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h1>Chart Test</h1>
    <div class="chart-container">
        <canvas id="testChart"></canvas>
    </div>

    <script>
        // Test data in the same format as our outcome data
        window.tableData = {
            "January": {"2022": 408531176.77, "2023": 263569916.63, "2024": 276004972.69, "2025": 0, "2026": 0},
            "February": {"2022": 239761718.38, "2023": 226356164.3, "2024": 191530929.47, "2025": 0, "2026": 0},
            "March": {"2022": 274068095.45, "2023": 218356164.3, "2024": 156530929.47, "2025": 0, "2026": 0}
        };
        window.tableColumns = ["2022", "2023", "2024", "2025", "2026"];
        window.tableRows = ["January", "February", "March"];

        // Test chart initialization
        function testChart() {
            if (typeof Chart !== 'undefined') {
                console.log('Chart.js loaded, version:', Chart.version);
                
                const ctx = document.getElementById('testChart');
                if (ctx && window.tableData && window.tableColumns && window.tableRows) {
                    console.log('Creating test chart...');
                    
                    const labels = window.tableRows;
                    const datasets = window.tableColumns.map((column, index) => {
                        const data = labels.map(row => {
                            const cellValue = window.tableData[row] ? window.tableData[row][column] : null;
                            let numericValue = 0;
                            if (cellValue !== null && cellValue !== '' && cellValue !== undefined) {
                                numericValue = parseFloat(cellValue) || 0;
                            }
                            return numericValue;
                        });
                        
                        const colors = [
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)'
                        ];
                        
                        return {
                            label: column,
                            data: data,
                            backgroundColor: colors[index % colors.length],
                            borderColor: colors[index % colors.length].replace('0.8', '1'),
                            borderWidth: 2
                        };
                    });
                    
                    const chartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value, index, values) {
                                            if (value >= 1000000000) {
                                                return 'RM ' + (value / 1000000000).toFixed(1) + 'B';
                                            } else if (value >= 1000000) {
                                                return 'RM ' + (value / 1000000).toFixed(1) + 'M';
                                            } else if (value >= 1000) {
                                                return 'RM ' + (value / 1000).toFixed(1) + 'K';
                                            } else {
                                                return 'RM ' + value.toFixed(2);
                                            }
                                        }
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Test Chart'
                                },
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const value = context.parsed.y;
                                            const formattedValue = new Intl.NumberFormat('en-MY', {
                                                style: 'currency',
                                                currency: 'MYR',
                                                minimumFractionDigits: 2,
                                                maximumFractionDigits: 2
                                            }).format(value);
                                            return context.dataset.label + ': ' + formattedValue;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                    console.log('Chart created successfully:', chartInstance);
                } else {
                    console.error('Missing elements or data');
                }
            } else {
                console.error('Chart.js not loaded');
                setTimeout(testChart, 100);
            }
        }

        // Start test
        document.addEventListener('DOMContentLoaded', testChart);
    </script>
</body>
</html>
